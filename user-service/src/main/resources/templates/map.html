<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê°•ì•„ì§€ ìš´ë™ì¥ ì§€ë„ | DogBuddy</title>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        #map {
            height: 600px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        #loading-message {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #555;
        }
    </style>

    <script type="text/javascript" src="//dapi.kakao.com/..."></script>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=7367f6d7815b12dea7f6cd612681bd74&libraries=services&autoload=false"></script>
</head>
<body>

<div class="container">
    <div id="loading-message">ì§€ë„ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
    <div id="map"></div>
</div>

<script>
    const GATEWAY_URL = 'http://localhost:8000';
    let map;

    function initMap() {
        // kakao ê°ì²´ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
        kakao.maps.load(function() {
            console.log("ì¹´ì¹´ì˜¤ ì§€ë„ SDK ë¡œë“œ ì™„ë£Œ");

            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­ ê¸°ì¤€
                level: 5
            };

            map = new kakao.maps.Map(container, options);
            document.getElementById('loading-message').style.display = 'none';

            // ë°ì´í„° ë¡œë“œ í˜¸ì¶œ
            fetchDogParks();
        });
    }

    function fetchDogParks() {
        // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ê³ ì • ì¢Œí‘œ ì „ë‹¬
        const url = `${GATEWAY_URL}/user/dog-parks?location=37.5665,126.9780`;

        fetch(url)
        .then(response => {
            if (response.ok) return response.json();
            throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
        })
        .then(data => {
            console.log("ë°›ì€ ë°ì´í„°:", data); // ğŸš¨ ì½˜ì†”ì—ì„œ ë°ì´í„°ê°€ ì–´ë–»ê²Œ ì˜¤ëŠ”ì§€ ê¼­ í™•ì¸í•˜ì„¸ìš”!

            // ì¹´ì¹´ì˜¤ ë°©ì‹(documents) ë˜ëŠ” ë„¤ì´ë²„ ë°©ì‹(items) ë‘˜ ë‹¤ ì§€ì›í•˜ë„ë¡ ì²˜ë¦¬
            const locations = data.documents || data.items || [];

            if (locations.length > 0) {
                locations.forEach(place => {
                    addMarker(place);
                });
                console.log(`${locations.length}ê°œì˜ ì¥ì†Œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
            } else {
                console.warn("í‘œì‹œí•  ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤. ì‘ë‹µ êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.", data);
            }
        })
        .catch(error => {
            console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
        });
    }

function addMarker(place) {
    const lat = place.y || place.mapy;
    const lng = place.x || place.mapx;
    const position = new kakao.maps.LatLng(lat, lng);

    const marker = new kakao.maps.Marker({ map: map, position: position });

    const title = place.place_name || place.title;
    const address = place.road_address_name || place.address;
    const placeUrl = place.place_url; // ğŸš¨ ì¹´ì¹´ì˜¤ ìƒì„¸ í˜ì´ì§€ URL
    const category = place.category_name; // ì˜ˆ: ë°˜ë ¤ë™ë¬¼ > ì• ê²¬ìš´ë™ì¥

    const content = `
        <div style="padding:15px; min-width:200px; border-radius:10px;">
            <div style="margin-bottom:8px;">
                <span style="font-size:10px; color:#888;">${category}</span>
                <strong style="display:block; font-size:14px; color:#4CAF50;">${title}</strong>
            </div>
            <div style="font-size:12px; color:#555; margin-bottom:10px;">
                ${address}
            </div>
            <div style="border-top:1px solid #eee; pt:8px;">
                <a href="${placeUrl}" target="_blank"
                   style="display:inline-block; margin-top:5px; color:#1e90ff; text-decoration:none; font-weight:bold; font-size:12px;">
                   ì¹´ì¹´ì˜¤ë§µì—ì„œ ìƒì„¸ ì •ë³´ ë³´ê¸° â†’
                </a>
            </div>
        </div>
    `;

    const infoWindow = new kakao.maps.InfoWindow({ content: content, removable: true });

    kakao.maps.event.addListener(marker, 'click', () => {
        infoWindow.open(map, marker);
    });
}

    window.onload = initMap;
</script>
</body>
</html>