server:
  port: 8000

spring:
  application:
    name: api-gateway # 유레카에 등록될 이름

  cloud:
    gateway:
      routes:
        # 1. Auth VIEW 경로 (토큰 필요 없는 페이지, 충돌 방지를 위해 명시적 경로 사용)
        - id: auth-view-route
          uri: lb://auth-service
          predicates:
            - Path=/view/signup
            - Path=/view/login
          # 필터는 RewritePath 없이 Path 그대로 전달

        # 2. User VIEW 경로 (강아지 지도 페이지, 충돌 방지를 위해 명시적 경로 사용)
        - id: user-view-route
          uri: lb://user-service
          predicates:
            - Path=/view/map
          # /view/map 요청을 user-service의 /view/map으로 그대로 전달
        #          filters:
        #            - RewritePath=/view/map(?<segment>/?.*), /view/map$segment

        # 3. Auth API 경로 (로그인, 회원가입 등)
        - id: auth-api-route
          uri: lb://auth-service
          predicates:
            - Path=/auth/**
          # /auth/ 이후의 경로를 서비스에 전달
          filters:
            - RewritePath=/auth/(?<segment>.*), /auth/${segment}

        # 4. User API 경로 (마이페이지, 지도 데이터 요청 등, JWT 검증 필요)
        - id: user-api-route
          uri: lb://user-service
          predicates:
            - Path=/user/**
          # /user/ 이후의 경로를 서비스에 전달
#          filters:
#            - RewritePath=/user/(?<segment>.*), /user/${segment}

        # 5. AI Service 라우팅 (미래를 위해 남겨둠)
        - id: ai-route
          uri: lb://ai-service
          predicates:
            - Path=/ai/**
          filters:
            - RewritePath=/ai/(?<segment>.*), /ai/${segment}

      discovery:
        locator:
          enabled: true
          lower-case-service-id: true

eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://localhost:8761/eureka/

service:
  jwt:
    expiration: 86400000
    secret-key: "bXlfc3VwZXJfc2VjcmV0X2tleV9oZWVkYWU5M19tc2FfcHJvamVjdF8xMjM0X2VuY29kZWQ="

# 디버깅을 위한 로그 레벨 설정
logging:
  level:
    org.springframework.cloud.gateway: DEBUG